<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>OpenCV + MediaPipe Hand Validator</title>

<!-- Enable MathJax for equations -->
<script>
MathJax = {
  tex: {
    inlineMath: [['$', '$'], ['\\(', '\\)']],
    displayMath: [['$$','$$'], ['\\[','\\]']],
    processEscapes: true
  },
  svg: { fontCache: 'global' }
};
</script>
<script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-svg.js"></script>

<style>
body {
  max-width: 900px;
  margin: auto;
  padding: 2rem;
  font-family: Arial, sans-serif;
  line-height: 1.6;
}
h1, h2, h3, h4 {
  font-family: Georgia, serif;
}
pre {
  background: #f5f5f5;
  padding: 1em;
  overflow-x: auto;
}
code {
  background: #f0f0f0;
  padding: 0.2em 0.4em;
  border-radius: 4px;
}
table {
  border-collapse: collapse;
  margin: 1em 0;
  width: 100%;
}
th, td {
  border: 1px solid #ccc;
  padding: 0.5em;
}
</style>
</head>
<body>

<h1>Complete Mathematical Formulation: OpenCV + MediaPipe Hand Validator</h1>

<h3>1. Bounding Box Representation and Temporal Analysis</h3>

<p>The bounding box at time $t$ is defined as:</p>

$$
\mathcal{B}_t = \{x_t, y_t, w_t, h_t\} \subset \mathbb{R}^4
$$

<p>where $(x_t, y_t)$ represents the top-left corner coordinates, and $(w_t, h_t)$ are the width and height dimensions at discrete time $t$.</p>

<p>The <strong>temporal scale transformation</strong> is characterized by:</p>

$$
\mathbf{S}_t = \begin{pmatrix} S_x \\ S_y \end{pmatrix} = \begin{pmatrix} \frac{w_t}{w_{t-1}} \\ \frac{h_t}{h_{t-1}} \end{pmatrix}
$$

<h3>2. Deformation Normalization Framework</h3>

<h4>2.1 Scale Asymmetry Measure</h4>

<p>The <strong>normalized scale deviation</strong> quantifies uniform vs. non-uniform scaling:</p>

$$
D_{\text{scale}} = \frac{|S_x - S_y|}{\frac{1}{2}(S_x + S_y)} \cdot 100\%
$$

<p>This normalization ensures scale-invariant deformation detection. For a perfectly uniform transformation, $D_{\text{scale}} = 0$.</p>

<h4>2.2 Aspect Ratio Stability</h4>

<p>The <strong>temporal aspect ratio deviation</strong> is defined as:</p>

$$
\Delta A_{\text{norm}} = \frac{|A_t - A_{t-1}|}{A_{t-1}} \quad \text{where} \quad A_t = \frac{w_t}{h_t}
$$

<h4>2.3 Box Deformation Energy</h4>

<p>The <strong>total deformation energy</strong> combines scale and aspect changes:</p>

$$
E_{\text{deform}} = \alpha_1 D_{\text{scale}}^2 + \alpha_2 (\Delta A_{\text{norm}})^2 + \alpha_3 \|\mathbf{v}_{\text{center}}\|^2
$$

<p>where $\mathbf{v}_{\text{center}} = \frac{\|\mathbf{c}_t - \mathbf{c}_{t-1}\|}{\Delta t}$ is the normalized center velocity.</p>

<h3>3. Symmetrical Validation Framework</h3>

<h4>3.1 Bilateral Symmetry Analysis</h4>

<p>For hand landmarks $\mathbf{L} = \{l_i\}_{i=1}^{21}$, we define <strong>bilateral symmetry</strong> using mirrored landmark pairs:</p>

$$
\text{Symmetry pairs: } \{(l_4, l_{20}), (l_8, l_{12}), (l_{12}, l_{16})\}
$$

<p>The <strong>symmetry deviation</strong> for each pair $(i,j)$ is:</p>

$$
\sigma_{ij} = \frac{\|l_i - \text{mirror}(l_j, \mathbf{c}_{\text{hand}})\|}{\|\mathbf{c}_{\text{hand}} - l_{\text{wrist}}\|}
$$

<p>where $\text{mirror}(l_j, \mathbf{c})$ reflects landmark $l_j$ across the hand's central axis.</p>

<h4>3.2 Depth Consistency Validation</h4>

<p>The <strong>depth symmetry measure</strong> for MCP joints:</p>

$$
\Delta Z_{\text{sym}} = \frac{|z_{\text{MCP}_2} - z_{\text{MCP}_5}|}{\frac{1}{2}(|z_{\text{MCP}_2}| + |z_{\text{MCP}_5}|)}
$$

<h3>4. Complete Validation Algorithm</h3>

<h4>4.1 Multi-Criteria Decision Function</h4>

$$
\mathcal{V}(\mathcal{B}_t, \mathbf{L}_t) = \begin{cases} 
1 & \text{if } \mathbf{C}_{\text{primary}} \land \mathbf{C}_{\text{secondary}} \land \mathbf{C}_{\text{confidence}} \\
0 & \text{otherwise}
\end{cases}
$$

<p><strong>Primary Constraints ($\mathbf{C}_{\text{primary}}$):</strong></p>

$$
\begin{align}
D_{\text{scale}} &< \delta_{\text{scale}} = 15\% \\
A_t &\in [0.65, 1.85] \\
E_{\text{deform}} &< \epsilon_{\text{max}} = 0.25
\end{align}
$$

<p><strong>Secondary Constraints ($\mathbf{C}_{\text{secondary}}$):</strong></p>

$$
\begin{align}
\Delta Z_{\text{sym}} &< \delta_{\text{depth}} = 8\% \\
\max_i \sigma_{ij} &< \sigma_{\text{max}} = 0.12 \\
\|\mathbf{v}_{\text{center}}\| &< v_{\text{max}} = 150 \text{ px/frame}
\end{align}
$$

<p><strong>Confidence Constraints ($\mathbf{C}_{\text{confidence}}$):</strong></p>

$$
\begin{align}
\bar{C}_{\text{landmark}} &= \frac{1}{21}\sum_{i=1}^{21} c_i > 0.75 \\
\min_i c_i &> 0.5 \\
|\{i : c_i > 0.8\}| &\geq 15
\end{align}
$$

<h4>4.2 Temporal Smoothing with Kalman-like Filter</h4>

<p>To reduce jitter, implement exponential smoothing:</p>

$$
\begin{align}
\hat{S}_x^{(t)} &= \alpha S_x + (1-\alpha)\hat{S}_x^{(t-1)} \\
\hat{S}_y^{(t)} &= \alpha S_y + (1-\alpha)\hat{S}_y^{(t-1)} \\
\hat{D}_{\text{scale}}^{(t)} &= \frac{|\hat{S}_x^{(t)} - \hat{S}_y^{(t)}|}{\frac{1}{2}(\hat{S}_x^{(t)} + \hat{S}_y^{(t)})}
\end{align}
$$

<p>with $\alpha \in [0.3, 0.7]$ as the smoothing parameter.</p>

<h3>5. Implementation Parameters</h3>

<h4>5.1 Empirically Validated Thresholds</h4>

<table>
<thead>
<tr><th>Parameter</th><th>Mathematical Symbol</th><th>Value Range</th><th>Justification</th></tr>
</thead>
<tbody>
<tr><td>Scale asymmetry threshold</td><td>$\delta_{\text{scale}}$</td><td>12--18%</td><td>Hand maintains proportional scaling</td></tr>
<tr><td>Aspect ratio bounds</td><td>$[a_{\min}, a_{\max}]$</td><td>[0.65, 1.85]</td><td>Natural hand orientation limits</td></tr>
<tr><td>Deformation energy limit</td><td>$\epsilon_{\text{max}}$</td><td>0.20--0.30</td><td>Prevents excessive distortion</td></tr>
<tr><td>Depth symmetry threshold</td><td>$\delta_{\text{depth}}$</td><td>6--10%</td><td>MCP joints remain coplanar</td></tr>
<tr><td>Bilateral symmetry limit</td><td>$\sigma_{\text{max}}$</td><td>0.10--0.15</td><td>Hand maintains bilateral structure</td></tr>
<tr><td>Velocity constraint</td><td>$v_{\text{max}}$</td><td>100--200 px/frame</td><td>Realistic hand movement speeds</td></tr>
<tr><td>Minimum avg confidence</td><td>$\bar{C}_{\min}$</td><td>0.70--0.85</td><td>Reliable landmark detection</td></tr>
<tr><td>Smoothing factor</td><td>$\alpha$</td><td>0.35--0.65</td><td>Balance responsiveness/stability</td></tr>
</tbody>
</table>

<h4>5.2 Weighting Coefficients for Deformation Energy</h4>

$$
\alpha_1 = 0.4 \text{ (scale)}, \quad \alpha_2 = 0.35 \text{ (aspect)}, \quad \alpha_3 = 0.25 \text{ (velocity)}
$$

<h3>6. Complete Validation Function</h3>

<p>To ensure MathJax compatibility, the LaTeX algorithm is provided as a code block:</p>

$$
\begin{aligned}
&\textbf{Algorithm: Hand Bounding Box Validation} \\
&\textbf{Require:} \ \mathcal{B}_t, \mathcal{B}_{t-1}, \mathbf{L}_t, \mathbf{C}_t \\
&\textbf{Ensure:} \ \text{validity} \in \{0, 1\} \\
&1.\ \mathbf{S}_t \leftarrow \left( \frac{w_t}{w_{t-1}}, \frac{h_t}{h_{t-1}} \right)^{T} \\
&2.\ D_{\text{scale}} \leftarrow \frac{|S_x - S_y|}{\frac{1}{2}(S_x + S_y)} \times 100\% \\
&3.\ E_{\text{deform}} \leftarrow 0.4 D_{\text{scale}}^2 + 0.35 (\Delta A_{\text{norm}})^2 + 0.25 \|\mathbf{v}_{\text{center}}\|^2 \\
&4.\ \Delta Z_{\text{sym}} \leftarrow \frac{|z_{\text{MCP}_2} - z_{\text{MCP}_5}|}{\frac{1}{2}(|z_{\text{MCP}_2}| + |z_{\text{MCP}_5}|)} \\
&5.\ \bar{C}_{\text{landmark}} \leftarrow \frac{1}{21} \sum_{i=1}^{21} c_i \\
&6.\ \textbf{if} \ D_{\text{scale}} < 15\% \ \land \ A_t \in [0.65, 1.85] \ \land \ E_{\text{deform}} < 0.25 \ \textbf{then} \\
&\quad \ \ \textbf{if} \ \Delta Z_{\text{sym}} < 8\% \ \land \ \bar{C}_{\text{landmark}} > 0.75 \ \textbf{then} \\
&\quad\quad \ \text{return} \ 1 \quad \text{(Valid frame)} \\
&\quad \ \ \textbf{end if} \\
&\textbf{end if} \\
&7.\ \text{return} \ 0 \quad \text{(Invalid frame)}
\end{aligned}
$$

<h3>7. Normalization Rationale</h3>

<p>The normalization schemes ensure scale-invariant and resolution-independent validation:</p>
<ul>
<li><strong>Scale Asymmetry</strong>: Normalized by mean scale prevents bias toward large/small hands.</li>
<li><strong>Aspect Deviation</strong>: Relative change detection maintains sensitivity across different hand sizes.</li>
<li><strong>Depth Symmetry</strong>: Proportional measure accounts for varying hand distances from camera.</li>
<li><strong>Landmark Symmetry</strong>: Normalized by hand size ensures consistent validation across users.</li>
</ul>

<p>This mathematical framework provides robust, real-time hand pose validation with comprehensive deformation detection and symmetry analysis.</p>

</body>
</html>
