<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Documentation Hub</title>

<!-- MathJax (simplified startup) -->
<script>
window.MathJax = {
  tex: {
    inlineMath: [['$', '$'], ['\\(', '\\)']],
    displayMath: [['$$','$$'], ['\\[','\\]']],
    processEscapes: true,
    processEnvironments: true,
    tags: 'ams'
  },
  svg: { fontCache: 'global' }
};
</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/3.2.2/es5/tex-svg.min.js" defer></script>

<!-- Prism.js for syntax highlighting -->
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-tomorrow.min.css" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-core.min.js" defer></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/plugins/autoloader/prism-autoloader.min.js" defer></script>

<style>
/* Keep your original styling */
:root {
  --primary-color: #2c3e50;
  --secondary-color: #3498db;
  --accent-color: #e74c3c;
  --background-color: #f8f9fa;
  --card-background: #ffffff;
  --text-color: #2c3e50;
  --border-color: #dee2e6;
  --shadow: 0 2px 10px rgba(0,0,0,0.1);
  --hover-shadow: 0 4px 20px rgba(0,0,0,0.15);
}
* {margin:0;padding:0;box-sizing:border-box;}
body {font-family:'Segoe UI',Tahoma,sans-serif;line-height:1.6;color:var(--text-color);background:var(--background-color);overflow-x:hidden;}
.container {max-width:1200px;margin:0 auto;padding:2rem;}
.header {background:linear-gradient(135deg,var(--primary-color),var(--secondary-color));color:white;padding:3rem 0;text-align:center;margin-bottom:2rem;position:relative;overflow:hidden;}
.header-content {position:relative;z-index:1;}
.header h1 {font-size:2.5rem;font-weight:700;margin-bottom:0.5rem;}
.header p {font-size:1.2rem;opacity:0.9;}
.nav-container {background:var(--card-background);border-radius:12px;box-shadow:var(--shadow);margin-bottom:2rem;padding:1rem;display:flex;align-items:center;gap:1rem;}
.back-btn {background:var(--secondary-color);color:white;border:none;padding:0.75rem 1.5rem;border-radius:8px;cursor:pointer;font-weight:600;display:none;}
.search-input {padding:0.75rem 1rem;border:2px solid var(--border-color);border-radius:8px;font-size:1rem;width:300px;}
.main-content {display:grid;grid-template-columns:1fr;gap:2rem;}
.docs-grid {display:grid;grid-template-columns:repeat(auto-fill,minmax(350px,1fr));gap:1.5rem;}
.doc-card {background:var(--card-background);border-radius:12px;box-shadow:var(--shadow);padding:1.5rem;cursor:pointer;transition:all 0.3s;}
.doc-card:hover {transform:translateY(-5px);box-shadow:var(--hover-shadow);}
.doc-title {font-size:1.3rem;font-weight:700;color:var(--primary-color);margin-bottom:0.5rem;}
.doc-excerpt {color:#666;font-size:0.95rem;margin-bottom:1rem;}
.doc-meta {display:flex;justify-content:space-between;font-size:0.85rem;color:#888;}
.content-viewer {display:none;background:var(--card-background);border-radius:12px;box-shadow:var(--shadow);overflow:hidden;}
.content-header {background:linear-gradient(135deg,#f8f9fa,#e9ecef);padding:2rem;border-bottom:1px solid var(--border-color);}
.content-title {font-size:2rem;font-weight:700;color:var(--primary-color);}
.content-meta {color:#666;font-size:1rem;}
iframe.doc-frame {width:100%;height:80vh;border:none;}
.loading, .error, .no-docs {text-align:center;padding:4rem 2rem;color:#666;}
.loading::after {content:'';display:inline-block;width:2rem;height:2rem;border:3px solid #f3f3f3;border-top:3px solid var(--secondary-color);border-radius:50%;animation:spin 1s linear infinite;margin-left:1rem;}
@keyframes spin {0%{transform:rotate(0deg);}100%{transform:rotate(360deg);}}
</style>
</head>
<body>

<header class="header">
  <div class="container">
    <div class="header-content">
      <h1>
        <img src="https://upload.wikimedia.org/wikipedia/commons/6/6b/Document_icon.svg" alt="Docs" style="height:1.2em;vertical-align:middle;margin-right:0.5em;">
        Documentation Hub
      </h1>
      <p>Explore our comprehensive documentation library</p>
    </div>
  </div>
</header>

<div class="container">
  <nav class="nav-container">
    <button class="back-btn" onclick="app.showDocsList()">‚Üê Back to Documents</button>
    <div class="breadcrumb"><span id="breadcrumb-text">All Documents</span></div>
    <input type="text" class="search-input" placeholder="Search documents..." id="searchInput">
  </nav>

  <main class="main-content">
    <div id="docs-list" class="docs-grid"><div class="loading">Loading documents...</div></div>
    <div id="content-viewer" class="content-viewer">
      <div class="content-header">
        <h1 class="content-title" id="content-title"></h1>
        <div class="content-meta" id="content-meta"></div>
      </div>
      <div class="content-body" id="content-body"></div>
    </div>
  </main>
</div>

<script>
class DocumentationHub {
  constructor() {
    this.documents = [];
    this.filteredDocuments = [];
    this.currentDocument = null;
    this.init();
  }

  async init() {
    await this.loadDocuments();
    this.setupEvents();
  }

  parseManifestPath(path, rootRepo) {
    return path.replace(/{root_repo}/g, rootRepo)
               .replace('tree/main', 'raw/main');
  }

  async fetchWithFallback(paths) {
    for (const url of paths) {
      try {
        const res = await fetch(url);
        if (res.ok) return res;
      } catch {}
    }
    throw new Error('All fetch attempts failed.');
  }

  async loadDocuments() {
    try {
      const manifestRes = await fetch('./pages/html/manifest.json');
      const manifest = await manifestRes.json();
      const rootRepo = manifest.root_repo || '';
      const files = manifest.files || [];

      const htmlFiles = files.filter(f => f.name.toLowerCase().endsWith('.html'));

      this.documents = await Promise.all(htmlFiles.map(async file => {
        const possibleUrls = [
          this.parseManifestPath(file.path, rootRepo),
          this.parseManifestPath(file.path, rootRepo).replace('raw/main', 'raw/HEAD')
        ];
        try {
          const res = await this.fetchWithFallback(possibleUrls);
          const htmlText = await res.text();
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(htmlText, 'text/html');
          const title = htmlDoc.querySelector('h1')?.textContent || file.name;
          const excerpt = htmlDoc.querySelector('p')?.textContent?.slice(0,150)+'...' || 'No description.';
          return {name:file.name, title, excerpt, url:possibleUrls[0]};
        } catch {
          return null;
        }
      }));

      this.documents = this.documents.filter(Boolean);
      this.filteredDocuments = [...this.documents];
      this.renderDocs();

    } catch (e) {
      document.getElementById('docs-list').innerHTML = `<div class="error">Error loading documents: ${e.message}</div>`;
    }
  }

  renderDocs() {
    const list = document.getElementById('docs-list');
    if (!this.filteredDocuments.length) {
      list.innerHTML = '<div class="no-docs">No documents found.</div>';
      return;
    }
    list.innerHTML = this.filteredDocuments.map(doc => `
      <div class="doc-card" onclick="app.showDocument('${doc.name}')">
        <h3 class="doc-title">${doc.title}</h3>
        <p class="doc-excerpt">${doc.excerpt}</p>
        <div class="doc-meta">
          <span>
            <img src="https://upload.wikimedia.org/wikipedia/commons/8/8a/Calendar_icon.svg" style="height:1em;vertical-align:middle;"> Date Unknown
          </span>
          <span>HTML</span>
        </div>
      </div>
    `).join('');
  }

  showDocument(name) {
    const doc = this.documents.find(d => d.name === name);
    if (!doc) return;
    this.currentDocument = doc;
    document.querySelector('.back-btn').style.display = 'block';
    document.getElementById('breadcrumb-text').textContent = doc.title;
    document.getElementById('docs-list').style.display = 'none';
    document.getElementById('content-viewer').style.display = 'block';
    const contentBody = document.getElementById('content-body');
    contentBody.innerHTML = `<iframe class="doc-frame" src="${doc.url}"></iframe>`;
    document.getElementById('content-title').textContent = doc.title;
    document.getElementById('content-meta').textContent = 'Source: Embedded Document';
  }

  showDocsList() {
    document.querySelector('.back-btn').style.display = 'none';
    document.getElementById('breadcrumb-text').textContent = 'All Documents';
    document.getElementById('docs-list').style.display = 'grid';
    document.getElementById('content-viewer').style.display = 'none';
    this.currentDocument = null;
  }

  filterDocs(query) {
    query = query.toLowerCase();
    this.filteredDocuments = this.documents.filter(d => 
      d.title.toLowerCase().includes(query) || d.excerpt.toLowerCase().includes(query)
    );
    this.renderDocs();
  }

  setupEvents() {
    document.getElementById('searchInput').addEventListener('input', e => this.filterDocs(e.target.value));
  }
}

const app = new DocumentationHub();
</script>

</body>
</html>
